<!DOCTYPE html>
<html>
<head>
  <title>Job Recommender</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../static/index.css">
</head>
<body>

  <div class="main-container">
    <nav class="navbar navbar-expand-lg shadow-sm" id="mainNavbar">
      <div class="container">
          <a class="navbar-brand fw-bold text-primary fs-1" href="#home">KaaryaSetu</a>

          <!-- Toggler button for small screens -->
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
              <span class="navbar-toggler-icon"></span>
          </button>

          <!-- Collapsible content -->
          <div class="collapse navbar-collapse flex justify-content-end" id="navbarContent">
              <ul class="navbar-nav me-3">
                  <li class="nav-item"><a class="nav-link" href="{{url_for('job.home')}}">Home</a></li>
                  <li class="nav-item"><a class="nav-link" href="#">Link 1</a></li>
                  <li class="nav-item"><a class="nav-link" href="#">Link 2</a></li>
                  <li class="nav-item"><a class="nav-link" href="#">Link 2</a></li>
              </ul>

              {% if 'username' in session %}
              <!-- Dropdown for logged in user -->
              <div class="dropdown">
                  <button class="btn btn-outline-primary dropdown-toggle" type="button" id="userMenu" data-bs-toggle="dropdown" aria-expanded="false">
                      ☰
                  </button>
                  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenu">
                      <li class="dropdown-item text-muted">Welcome, {{ session.username }}</li>
                      <li><hr class="dropdown-divider"></li>
                      <li><a class="dropdown-item" href="{{ url_for('dashboard.dashboard') }}">Profile</a></li>
                      <li><a class="dropdown-item" href="#">Settings</a></li>
                      <li class="dropdown-item">
                          <div class="d-flex align-items-center justify-content-between">
                              <span class="text-muted me-2">Theme:</span>
                              <div>
                              <button class="btn btn-sm btn-light border me-1" onclick="setTheme('light')" title="Light Mode"></button>
                              <button class="btn btn-sm btn-dark border" onclick="setTheme('dark')" title="Dark Mode"></button>
                              </div>
                          </div>
                      </li>
                      <li><hr class="dropdown-divider"></li>
                      <li><a class="dropdown-item text-danger" href="{{ url_for('auth.logout') }}">Logout</a></li>
                  </ul>
              </div>
              {% else %}
              <!-- Login/Register buttons -->
              <div class="d-flex">
                  <button class="btn btn-outline-primary me-2" data-bs-toggle="modal" data-bs-target="#loginModal">Login</button>
                  <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#registerModal">Register</button>
              </div>
              {% endif %}
          </div>
      </div>
    </nav>
  </div>
  <div class="container mt-5">
  <form method="get" action="{{ url_for('job.filter_jobs') }}">
    <input type="hidden" name="id" value="{{ result_id }}">

    <div class="row col-12">
      <!-- Qualification Dropdown -->
      <div class="col-12 col-sm-6 col-lg-3">
        <label for="filter_qualification" class="form-label">Qualification</label>
        <select name="filter_qualification" id="filter_qualification" class="form-select">
          <option value="" {% if not filters.qualification %}selected{% endif %}>Select Qualification</option>
          <option value="PhD" {% if filters.qualification == 'PhD' %}selected{% endif %}>PhD</option>
          <option value="BBA" {% if filters.qualification == 'BBA' %}selected{% endif %}>BBA</option>
          <option value="BA" {% if filters.qualification == 'BA' %}selected{% endif %}>BA</option>
          <option value="BCA" {% if filters.qualification == 'BCA' %}selected{% endif %}>BCA</option>
          <option value="B.Tech" {% if filters.qualification == 'B.Tech' %}selected{% endif %}>B.Tech</option>
          <option value="B.Com" {% if filters.qualification == 'B.Com' %}selected{% endif %}>B.Com</option>
          <option value="M.Tech" {% if filters.qualification == 'M.Tech' %}selected{% endif %}>M.Tech</option>
          <option value="MBA" {% if filters.qualification == 'MBA' %}selected{% endif %}>MBA</option>
          <option value="M.Com" {% if filters.qualification == 'M.Com' %}selected{% endif %}>M.Com</option>
          <option value="MCA" {% if filters.qualification == 'MCA' %}selected{% endif %}>MCA</option>
        </select>
      </div>

      <div class="col-12 col-sm-6 col-lg-3  ">
        <label for="filter_experience" class="form-label">Experience</label>
        <select id="filter_experience" name="filter_experience" class="form-select">
          <option value="" {% if not filters.experience %}selected{% endif %}>Any</option>
          <option value="0-2" {% if filters.experience == '0-2' %}selected{% endif %}>0–2 years</option>
          <option value="3-5" {% if filters.experience == '3-5' %}selected{% endif %}>3–5 years</option>
          <option value="6-10" {% if filters.experience == '6-10' %}selected{% endif %}>6–10 years</option>
          <option value="10+" {% if filters.experience == '10+' %}selected{% endif %}>10+ years</option>
        </select>
      </div>

      <div class="col-12 col-sm-6 col-lg-2">
        <label for="filter_work_type" class="form-label">Work Type</label>
        <select id="filter_work_type" name="filter_work_type" class="form-select">
          <option value="" {% if not filters.work_type %}selected{% endif %}>Any</option>
          <option value="full-time" {% if filters.work_type == 'full-time' %}selected{% endif %}>Full-time</option>
          <option value="part-time" {% if filters.work_type == 'part-time' %}selected{% endif %}>Part-time</option>
          <option value="intern" {% if filters.work_type == 'intern' %}selected{% endif %}>Intern</option>
          <option value="contract" {% if filters.work_type == 'contract' %}selected{% endif %}>Contract</option>
          <option value="remote" {% if filters.work_type == 'remote' %}selected{% endif %}>Remote</option>
        </select>
      </div>

      <div class="col-12 col-sm-6 col-lg-2">
        <label for="filter_country" class="form-label">Country</label>
        <input type="text" id="filter_country" name="filter_country" class="form-control" value="{{ filters.country }}">
      </div>

      <div class="col-12 col-sm-6 col-lg-2">
        <label for="filter_sector" class="form-label">Sector</label>
        <input type="text" id="filter_sector" name="filter_sector" class="form-control" value="{{ filters.sector }}">
      </div>
    </div>

    <div class="mt-3">
      <button type="submit" class="btn btn-primary">Apply Filters</button>
    </div>
  </form>
</div>


    <!-- Recommended Jobs -->
    <div class="container mt-5">
      {% if jobs and jobs | length > 0 %}
      <h3 class="mb-4 text-center text-success">Top Job Matches</h3>
      <div class="row">
        {% for job in jobs %}
        <div class="col-md-6 mb-4">
          <div class="card shadow-sm h-100">
            <div class="card-body">
              <h5 class="card-title">{{ job['Job Title'] }}</h5>
              <h6 class="card-subtitle ">{{ job['Company'] }} — {{ job['location'] }}</h6>
              <p class="card-text mt-2">
                <strong>Matched:</strong> {{ job['match_percent'] }}%<br>
                <strong>Qualification:</strong> {{ job['Qualifications'] }}<br>
                <strong>Skills:</strong> {{ job['skills'] }}
              </p>
              {% set website = job.get('Website', '#') %}
              {% if website and not website.startswith('http') %}
                {% set website = 'https://' + website %}
              {% endif %}
              {% set applyLink = 'https://' + job.get('Job Portal') + '.com' %}
              <a href="#" class="btn btn-sm btn-outline-info"
                data-bs-toggle="modal" data-bs-target="#jobDetailsModal"
                data-jobId="{{ job['Job Id'] }}"
                data-title="{{ job['Job Title'] }}"
                data-company="{{ job['Company'] }}"
                data-profile="{{ job['Company Profile'] }}"
                data-role="{{ job['Role'] }}"
                data-experience="{{ job['Experience'] }}"
                data-qualifications="{{ job['Qualifications'] }}"
                data-skills="{{ job['skills'] }}"
                data-responsibilities="{{ job['Responsibilities'] }}"
                data-salary="{{ job['Salary Range'] }}"
                data-benefits="{{ job['Benefits'] }}"
                data-description="{{ job['Job Description'] }}"
                data-location="{{ job['location'] }}"
                data-city="{{ job['City'] }}"
                data-state="{{ job['State'] }}"
                data-zip="{{ job['Zip'] }}"
                data-country="{{ job['Country'] }}"
                data-lat="{{ job['latitude'] }}"
                data-lng="{{ job['longitude'] }}"
                data-sector="{{ job['Sector'] }}"
                data-industry="{{ job['Industry'] }}"
                data-worktype="{{ job['Work Type'] }}"
                data-size="{{ job['Company Size'] }}"
                data-ceo="{{ job['CEO'] }}"
                data-ticker="{{ job['Ticker'] }}"
                data-posted="{{ job['Job Posting Date'] }}"
                data-preference="{{ job['Preference'] }}"
                data-contact-person="{{ job['Contact Person'] }}"
                data-contact="{{ job['Contact'] }}"
                data-apply="{{ applyLink }}"
                data-website="{{ website }}">
                More Info
              </a>


            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="text-center text-muted">
        <p>No job recommendations yet.</p>
      </div>
      {% endif %}
    </div>


    {% if total_pages > 1 %}
      <nav class="mt-4">
        <ul class="pagination justify-content-center">
          {# Previous Button #}
          {% if current_page > 1 %}
            <li class="page-item">
              <a class="page-link" href="{{ url_for('job.filter_jobs', id=result_id, page=current_page - 1,
                  filter_experience=filters.experience,
                  filter_work_type=filters.work_type,
                  filter_country=filters.country,
                  filter_sector=filters.sector,
                  filter_qualification=filters.qualification) }}">
                Previous
              </a>
            </li>
          {% endif %}

          {# Page Numbers with Ellipsis #}
          {% for p in range(1, total_pages + 1) %}
            {% if p == 1 or p == total_pages or (p >= current_page - 1 and p <= current_page + 1) %}
              <li class="page-item {% if p == current_page %}active{% endif %}">
                <a class="page-link" href="{{ url_for('job.filter_jobs', id=result_id, page=p,
                    filter_experience=filters.experience,
                    filter_work_type=filters.work_type,
                    filter_country=filters.country,
                    filter_sector=filters.sector,
                    filter_qualification=filters.qualification) }}">
                  {{ p }}
                </a>
              </li>
            {% elif p == 2 and current_page > 4 %}
              <li class="page-item disabled"><span class="page-link">...</span></li>
            {% elif p == total_pages - 1 and current_page < total_pages - 3 %}
              <li class="page-item disabled"><span class="page-link">...</span></li>
            {% endif %}
          {% endfor %}

          {# Next Button #}
          {% if current_page < total_pages %}
            <li class="page-item">
              <a class="page-link" href="{{ url_for('job.filter_jobs', id=result_id, page=current_page + 1,
                  filter_experience=filters.experience,
                  filter_work_type=filters.work_type,
                  filter_country=filters.country,
                  filter_sector=filters.sector,
                  filter_qualification=filters.qualification) }}">
                Next
              </a>
            </li>
          {% endif %}
        </ul>
      </nav>
    {% endif %}


  <!-- Job Details Modal -->
  <div class="modal fade" id="jobDetailsModal" tabindex="-1" aria-labelledby="jobDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content border-0 shadow">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title" id="jobDetailsModalLabel">Job Details</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body p-4">
          <div class="row">
            <div class="col-md-8">
              <h2 id="modalTitle" class="text-primary"></h2>
              <h5 id="modalCompany"></h5>
              <div><strong><span id="modalWorkType"></span></strong></div>
              <hr>
              <div class="mb-2"><strong>Role:</strong> <span id="modalRole"></span></div>
              <div class="mb-2"><strong>Experience:</strong> <span id="modalExperience"></span></div>
              <div class="mb-2"><strong>Qualifications:</strong> <span id="modalQualifications"></span></div>
              <div class="mb-2"><strong>Skills:</strong> <span id="modalSkills"></span></div>
              <div class="mb-2"><strong>Responsibilities:</strong> <span id="modalResponsibilities"></span></div>
              <div class="mb-2"><strong>Salary Range:</strong> <span id="modalSalary"></span></div>
              <div class="mb-2"><strong>Benefits:</strong> <span id="modalBenefits"></span></div>
              <div class="mb-2"><strong>Description:</strong> <span id="modalDescription"></span></div>
            </div>

            <div class="col-md-4">
              <div class="side rounded p-3">
                <div><strong>Location:</strong> <span id="modalLocation"></span></div>
                <div><strong>City:</strong> <span id="modalCity"></span></div>
                <div><strong>State:</strong> <span id="modalState"></span></div>
                <div><strong>Zip:</strong> <span id="modalZip"></span></div>
                <div><strong>Country:</strong> <span id="modalCountry"></span></div>
                <div><strong>Latitude:</strong> <span id="modalLatitude"></span></div>
                <div><strong>Longitude:</strong> <span id="modalLongitude"></span></div>
                <hr>
                <div><strong>Sector:</strong> <span id="modalSector"></span></div>
                <div><strong>Industry:</strong> <span id="modalIndustry"></span></div>
                <div><strong>Company Size:</strong> <span id="modalCompanySize"></span></div>
                <div><strong>CEO:</strong> <span id="modalCeo"></span></div>
                <div><strong>Ticker:</strong> <span id="modalTicker"></span></div>
                <div><strong>Job Posted:</strong> <span id="modalPosted"></span></div>
                <div><strong>Preference:</strong> <span id="modalPreference"></span></div>
                <div><strong>Contact Person:</strong> <span id="modalContactPerson"></span></div>
                <div><strong>Contact:</strong> <span id="modalContact"></span></div>
              </div>
              <div class="mt-3 text-center">
                <a id="applyButton" href="#" target="_blank" rel="noopener noreferrer" class="btn btn-success w-100">
                  Apply Now
                </a>
                <a id="modalWebsite" href="#" target="_blank" rel="noopener noreferrer" class="btn btn-outline-primary mt-2 w-100">
                  Visit Company Website
                </a>
                <a id="saveJobButton" href="#" class="btn btn-outline-warning mt-2 w-100">
                  Save Job
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


  <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
  <script src="{{ url_for('static', filename='js/index.js') }}"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>


